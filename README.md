# SureFly

This repo is the codebase for the crowdsourced decentralized insurance platform SureFly developed for proffer hackathon

There are two parts of this project

* A Toshi Bot project: UI for the platform using a Toshi Bot
* A Truffle project for the smart contracts


Using this app you can

* Insure your flight from misses
* Invest in people's insurance policy

Read our [problem statement and solution](https://docs.google.com/document/d/1M0w_6ArvHGOpiro6yM1p4IM7u9SvdDZ-HENzLx1EttY/edit?usp=sharing).

## How to use

* Download the Toshi App
* Search for SureFlyBot
* Click on message: You are good to go! 


## Basic Process Flow:

For a person who wants to insure his/her flight (Will be called seeker in all future references):
 * Seeker enters personal and flight details 
 * Identity is confirmed using Aadhar and flight ticket data is recieved from the airlines
 * Based on the time of booking the insurance and his location, a probability is generated by the system, of him missing the flight
 * A maximum premium amount is calculated on the basis of this probability
 * The seeker is asked the maximum and minimum amount that he wants to insure and is asked to pay the max amount he enters as the premimum

For a person who wants to invest in other people's investment policies (Will be referred to as investor):
  * The investor is shown a list of policies open for investment, along with all the details like the calculated probability, ETA to airport, present pool size for each policy.
  * He chooses the one he wants to invest in and is then asked for the amount which he is asked to pay. The ratio of this amount to the maximum payout, decides his share of returns of the premium.
  * Thus, with a number of investors, the pool starts getting filled. In case, the minimum amount is not met, the policy stands cancelled and everyone gets their money back.





[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)

Then check out [`src/bot.js`](src/bot.js) to start changing the bot logic.

## Running locally with Docker

You can run the project locally with

```
docker-compose up
```

If any new depencies are added you can rebuild the project with

```
docker-compose build
```

To reset the postgres database in your dev environment you can use

```
docker-compose down -v
```

## Architecture

Deploying a Toshi app requires a few processes to run:

* **toshi-headless-client**<br>
  This is a client we provide (similar to the iOS or Android client) that provides a wrapper around the Toshi backend services. It also handles end-to-end encrypting all messages using the Signal protocol. It is written in Java and runs in the background, proxying all the requests to and from your bot.
* **redis**<br>
  We use redis pub/sub to provide a connection between the toshi-headless-client and your bot.
* **bot.js**<br>
  This is where all your app logic lives.
* **postgres**<br>
  Postgres is used to store session data so you can persist state for each user who talks to your bot (similar to cookies in a web browser).

![diagram](docs/images/app-architecture.png)

## See also

* [https://www.toshi.org]
